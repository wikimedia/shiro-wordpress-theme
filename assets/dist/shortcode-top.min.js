jQuery(document).ready(function(e){"use strict";var t,i,a=topAtts,n=e("#"+a.id),r=e("#year-select"),d=n.find(".no-data"),c=e(".top-data-content"),s=e(".article-photo-credits-container"),l={edits:[],views:[]};function p(){var t,i=n.find("input:checked").val();l[i].length>0?o(i):(t="","edits"===i?(t=a.url_edits.indexOf(".csv")>-1?a.url_edits:"",d3.csv(t,function(e){return e}).then(function(e){l.edits=e,p()})):(t=a.url_views.indexOf(".csv")>-1?a.url_views:"",d3.csv(t,function(e){return e}).then(function(e){l.views=e,p()}))),r.find("option").each(function(){var t=parseInt(e(this).val(),10);l[i].filter(function(e){return parseInt(e.year,10)===t}).length>0?e(this).removeAttr("disabled"):e(this).attr("disabled","true")})}function o(r){var p="",o="string"==typeof r?r:n.find("input:checked").val();e("#year-select option:selected").each(function(){p+=e(this).text()+" "}),function(n,r){var l="views"===r?"wiki":"wiki_db",p=n.map(function(e){return e[l]}),o=a[r+"_label"],f="views"===r?"pageviews":"edits",u="views"===r?"daily_views":"daily_edits",h=[];s.find(".article-photo-credits").text(""),s.hide(),c.each(function(){var r=e(this),c=e(this).attr("id"),g=n.find(function(e){return e[l]===c}),v="";if(d.hide(),r.hide(),p.indexOf(c)>-1){var m=g["desc_"+a.lang.replace("wiki","")].replace(/"/g,""),w=g.pagetitle.replace(/_/g," "),k=g.file_name.replace("File:",""),x=a.directory+k.replace(".svg",".png").replace(".JPG",".jpg"),y=d3.format(",")(g[f]),_=g[u].split("_").map(function(e){return parseInt(e,10)}),b="#"+c+"-graph";e(b).empty(),function(e,a){var n,r;n=d3.scaleLinear().domain([0,d3.max(e,function(e){return e})]).nice().range([40,6]),r=d3.scaleLinear().domain([0,e.length]).range([0,300]),t=d3.line().defined(function(e){return!isNaN(e)}).curve(d3.curveBasis).x(function(e,t){return r(t)}).y(function(e){return n(e)}),(i=d3.select(a).append("svg").attr("viewBox",[0,0,300,46])).append("g").attr("class","bg-line-graph").append("line").style("stroke","#c8ccd1").attr("x1",0).attr("x2",300).attr("y1",40).attr("y2",40),i.append("g").attr("class","line-graph").append("path").datum(e).attr("fill","none").attr("stroke","#72777D").attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",t)}(_,b),r.find(".heading").text(w),r.find(".desc").text(m),g[l].replace("wiki","").match(/^[a-zA-Z\-]{2,16}$/)&&r.find(".details").attr("href","https://"+g[l].replace("wiki","")+".wikipedia.org/wiki/"+g.pagetitle).attr("target","_blank"),r.find(".data span").text(y+" "+o),k.length>0&&x.length>0?(r.find(".article-image").removeClass("article-image-fallback").css("background-image",'url("'+x+'")'),r.find(".article-image-link").attr("href",g.image_page),-1===h.indexOf(k)&&(h.push(k),v+=g.artist.length>0?", "+g.artist:"",v+=g.license.length>0?", "+g.license:"",s.find(".article-photo-credits").append(e("<div></div>").append(e("<a>").text(k).attr("href",g.image_page)).append(e("<span></span>").text(v))))):(r.find(".article-image-link > div").unwrap(),r.find(".article-image").attr("style","").addClass("article-image-fallback")),r.fadeIn(),s.show()}else d.show()})}(l[o].filter(function(e){return parseInt(e.year,10)===parseInt(p,10)}),o)}c.each(function(){e(this).hide()}),p(),r.change(o),n.find("input").change(p)});